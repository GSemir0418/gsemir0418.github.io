<!DOCTYPE html>
<html><head>
<title>NodeHTTP模块</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="NodeHTTP模块" />
<meta property="og:description" content="0 准备工作 1 ts-node-dev  当文件更新时自动重启node 避免每次改完代码都要重新运行的麻烦 可以用TS开发Node.js程序，且会自动重启 不宜在生产环境使用，但非常适合用来学习  安装
npm -g i ts-node-dev要用npm安装 ，用yarn安装的话使用时会报错。。无法识别“ts-node-dev”命令，不知道为什么。
2 VSCode配置 配置自动保存与保存后自动格式化：
ctrl shift p打开首选项：打开设置(ui)，AutoSave修改为onFocusChange，搜索format，勾选Format On Save开启保存后自动格式化。
3 curl  GET请求：curl -v url POST请求：curl -v -d “name=gsq&quot; url 设置请求头：-H &#39;Content-Type:application/json&#39; 设置动词：-X PUT JSON请求：curl -d &#39;{&quot;name&quot;:&quot;bob&quot;}&#39; -H &#39;Content-Type:application/json&#39; url 后面会用到curl来构造请求  1 创建项目  初始化项目：  yarn init -y 安装@types/node声明文件  yarn add --dev @types/node 新建index.ts  // 引入http模块 import * as http from &#39;http&#39; // 用http创建server const server = http." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gsemir0418.github.io/posts/nodehttp%E6%A8%A1%E5%9D%97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-30T09:55:55&#43;08:00" />
<meta property="article:modified_time" content="2021-06-30T09:55:55&#43;08:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="NodeHTTP模块"/>
<meta name="twitter:description" content="0 准备工作 1 ts-node-dev  当文件更新时自动重启node 避免每次改完代码都要重新运行的麻烦 可以用TS开发Node.js程序，且会自动重启 不宜在生产环境使用，但非常适合用来学习  安装
npm -g i ts-node-dev要用npm安装 ，用yarn安装的话使用时会报错。。无法识别“ts-node-dev”命令，不知道为什么。
2 VSCode配置 配置自动保存与保存后自动格式化：
ctrl shift p打开首选项：打开设置(ui)，AutoSave修改为onFocusChange，搜索format，勾选Format On Save开启保存后自动格式化。
3 curl  GET请求：curl -v url POST请求：curl -v -d “name=gsq&quot; url 设置请求头：-H &#39;Content-Type:application/json&#39; 设置动词：-X PUT JSON请求：curl -d &#39;{&quot;name&quot;:&quot;bob&quot;}&#39; -H &#39;Content-Type:application/json&#39; url 后面会用到curl来构造请求  1 创建项目  初始化项目：  yarn init -y 安装@types/node声明文件  yarn add --dev @types/node 新建index.ts  // 引入http模块 import * as http from &#39;http&#39; // 用http创建server const server = http."/>







<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>






<link rel="stylesheet" href="https://gsemir0418.github.io/scss/journal.min.5e8f3f653e9f6ce67bf72ff8ee6fee69decf7b5639a3ae7f8344750ad4e065b1.css" integrity="sha256-Xo8/ZT6fbOZ79y/47m/uad7Pe1Y5o65/g0R1CtTgZbE=" media="screen">



<link rel="stylesheet" href="https://gsemir0418.github.io/scss/dark-mode.min.bdfa63b2e89903517dcbb1032b537d54cff3f425c19d008a78dfe49e6cd07ced.css" integrity="sha256-vfpjsuiZA1F9y7EDK1N9VM/z9CXBnQCKeN/knmzQfO0=" media="screen">


<script src="https://gsemir0418.github.io//js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>




  
    <script src="https://gsemir0418.github.io//js/toc-collapse.js"></script>
  



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'your client id',
  clientSecret: 'your client secret',
  repo: 'repo name',
  owner: 'user',
  admin: ['user'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>








</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://gsemir0418.github.io/">
    
        <div class="nav-title">
            GSemir Blog
        </div>
        
        <div class="nav-subtitle">
            个人技术博客
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2021 GSemir Blog
	

    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#0-%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" onclick="onNavClick(`#0-准备工作-nav`)" id="0-准备工作-nav">
									0 准备工作
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#1-ts-node-dev" onclick="onNavClick(`#1-ts-node-dev-nav`)" id="1-ts-node-dev-nav">
									1 ts-node-dev
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-vscode%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#2-vscode配置-nav`)" id="2-vscode配置-nav">
									2 VSCode配置
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-curl" onclick="onNavClick(`#3-curl-nav`)" id="3-curl-nav">
									3 curl
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#1-%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae" onclick="onNavClick(`#1-创建项目-nav`)" id="1-创建项目-nav">
									1 创建项目
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-request%e5%af%b9%e8%b1%a1" onclick="onNavClick(`#2-request对象-nav`)" id="2-request对象-nav">
									2 request对象
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-response%e5%af%b9%e8%b1%a1" onclick="onNavClick(`#3-response对象-nav`)" id="3-response对象-nav">
									3 response对象
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e6%a0%b9%e6%8d%aeurl%e8%bf%94%e5%9b%9e%e4%b8%8d%e5%90%8c%e7%9a%84%e6%96%87%e4%bb%b6" onclick="onNavClick(`#4-根据url返回不同的文件-nav`)" id="4-根据url返回不同的文件-nav">
									4 根据url返回不同的文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#5-%e5%a4%84%e7%90%86%e6%9f%a5%e8%af%a2%e5%8f%82%e6%95%b0" onclick="onNavClick(`#5-处理查询参数-nav`)" id="5-处理查询参数-nav">
									5 处理查询参数
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#6-%e5%8c%b9%e9%85%8d%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6" onclick="onNavClick(`#6-匹配任意文件-nav`)" id="6-匹配任意文件-nav">
									6 匹配任意文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#7-%e5%a4%84%e7%90%86%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e6%96%87%e4%bb%b6" onclick="onNavClick(`#7-处理不存在的文件-nav`)" id="7-处理不存在的文件-nav">
									7 处理不存在的文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#1-%e6%96%87%e4%bb%b6%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e6%83%85%e5%86%b5" onclick="onNavClick(`#1-文件不存在的情况-nav`)" id="1-文件不存在的情况-nav">
									1 文件不存在的情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e5%bd%93%e8%ae%bf%e9%97%ae%e8%b7%af%e5%be%84%e4%b8%ba%e6%a0%b9%e8%b7%af%e5%be%84httplocalhost8888%e6%97%b6%e9%bb%98%e8%ae%a4%e8%ae%bf%e9%97%aeindexhtml" onclick="onNavClick(`#2-当访问路径为根路径httplocalhost8888时默认访问indexhtml-nav`)" id="2-当访问路径为根路径httplocalhost8888时默认访问indexhtml-nav">
									2 当访问路径为根路径http://localhost:8888时，默认访问index.html
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3%e5%bd%93%e8%ae%bf%e9%97%ae%e8%b7%af%e5%be%84%e4%b8%8d%e6%98%af%e6%96%87%e4%bb%b6%e8%80%8c%e6%98%af%e7%9b%ae%e5%bd%95%e6%97%b6" onclick="onNavClick(`#3当访问路径不是文件而是目录时-nav`)" id="3当访问路径不是文件而是目录时-nav">
									3.当访问路径不是文件而是目录时
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4%e5%85%b6%e4%bb%96%e9%94%99%e8%af%af%e4%b8%80%e5%be%8b%e5%bd%92%e4%b8%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%86%85%e9%83%a8%e9%94%99%e8%af%af" onclick="onNavClick(`#4其他错误一律归为服务器内部错误-nav`)" id="4其他错误一律归为服务器内部错误-nav">
									4.其他错误一律归为服务器内部错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#8-%e5%a4%84%e7%90%86%e9%9d%9eget%e8%af%b7%e6%b1%82" onclick="onNavClick(`#8-处理非get请求-nav`)" id="8-处理非get请求-nav">
									8 处理非GET请求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#9-%e6%b7%bb%e5%8a%a0%e7%bc%93%e5%ad%98%e9%80%89%e9%a1%b9" onclick="onNavClick(`#9-添加缓存选项-nav`)" id="9-添加缓存选项-nav">
									9 添加缓存选项
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#10-%e5%8f%91%e5%b8%83%e6%9c%aa%e5%ae%8c%e6%88%90" onclick="onNavClick(`#10-发布未完成-nav`)" id="10-发布未完成-nav">
									10 发布(未完成)
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#0-%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" onclick="onNavClick(`#0-准备工作-nav`)" id="0-准备工作-nav">
									0 准备工作
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#1-ts-node-dev" onclick="onNavClick(`#1-ts-node-dev-nav`)" id="1-ts-node-dev-nav">
									1 ts-node-dev
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-vscode%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#2-vscode配置-nav`)" id="2-vscode配置-nav">
									2 VSCode配置
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-curl" onclick="onNavClick(`#3-curl-nav`)" id="3-curl-nav">
									3 curl
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#1-%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae" onclick="onNavClick(`#1-创建项目-nav`)" id="1-创建项目-nav">
									1 创建项目
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-request%e5%af%b9%e8%b1%a1" onclick="onNavClick(`#2-request对象-nav`)" id="2-request对象-nav">
									2 request对象
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-response%e5%af%b9%e8%b1%a1" onclick="onNavClick(`#3-response对象-nav`)" id="3-response对象-nav">
									3 response对象
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e6%a0%b9%e6%8d%aeurl%e8%bf%94%e5%9b%9e%e4%b8%8d%e5%90%8c%e7%9a%84%e6%96%87%e4%bb%b6" onclick="onNavClick(`#4-根据url返回不同的文件-nav`)" id="4-根据url返回不同的文件-nav">
									4 根据url返回不同的文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#5-%e5%a4%84%e7%90%86%e6%9f%a5%e8%af%a2%e5%8f%82%e6%95%b0" onclick="onNavClick(`#5-处理查询参数-nav`)" id="5-处理查询参数-nav">
									5 处理查询参数
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#6-%e5%8c%b9%e9%85%8d%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6" onclick="onNavClick(`#6-匹配任意文件-nav`)" id="6-匹配任意文件-nav">
									6 匹配任意文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#7-%e5%a4%84%e7%90%86%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e6%96%87%e4%bb%b6" onclick="onNavClick(`#7-处理不存在的文件-nav`)" id="7-处理不存在的文件-nav">
									7 处理不存在的文件
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#1-%e6%96%87%e4%bb%b6%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e6%83%85%e5%86%b5" onclick="onNavClick(`#1-文件不存在的情况-nav`)" id="1-文件不存在的情况-nav">
									1 文件不存在的情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e5%bd%93%e8%ae%bf%e9%97%ae%e8%b7%af%e5%be%84%e4%b8%ba%e6%a0%b9%e8%b7%af%e5%be%84httplocalhost8888%e6%97%b6%e9%bb%98%e8%ae%a4%e8%ae%bf%e9%97%aeindexhtml" onclick="onNavClick(`#2-当访问路径为根路径httplocalhost8888时默认访问indexhtml-nav`)" id="2-当访问路径为根路径httplocalhost8888时默认访问indexhtml-nav">
									2 当访问路径为根路径http://localhost:8888时，默认访问index.html
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3%e5%bd%93%e8%ae%bf%e9%97%ae%e8%b7%af%e5%be%84%e4%b8%8d%e6%98%af%e6%96%87%e4%bb%b6%e8%80%8c%e6%98%af%e7%9b%ae%e5%bd%95%e6%97%b6" onclick="onNavClick(`#3当访问路径不是文件而是目录时-nav`)" id="3当访问路径不是文件而是目录时-nav">
									3.当访问路径不是文件而是目录时
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4%e5%85%b6%e4%bb%96%e9%94%99%e8%af%af%e4%b8%80%e5%be%8b%e5%bd%92%e4%b8%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%86%85%e9%83%a8%e9%94%99%e8%af%af" onclick="onNavClick(`#4其他错误一律归为服务器内部错误-nav`)" id="4其他错误一律归为服务器内部错误-nav">
									4.其他错误一律归为服务器内部错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#8-%e5%a4%84%e7%90%86%e9%9d%9eget%e8%af%b7%e6%b1%82" onclick="onNavClick(`#8-处理非get请求-nav`)" id="8-处理非get请求-nav">
									8 处理非GET请求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#9-%e6%b7%bb%e5%8a%a0%e7%bc%93%e5%ad%98%e9%80%89%e9%a1%b9" onclick="onNavClick(`#9-添加缓存选项-nav`)" id="9-添加缓存选项-nav">
									9 添加缓存选项
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#10-%e5%8f%91%e5%b8%83%e6%9c%aa%e5%ae%8c%e6%88%90" onclick="onNavClick(`#10-发布未完成-nav`)" id="10-发布未完成-nav">
									10 发布(未完成)
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://gsemir0418.github.io/">
            GSemir Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://gsemir0418.github.io/">
        <div class="single-column-header-title">GSemir Blog</div>
        
        <div class="single-column-header-subtitle">个人技术博客</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    NodeHTTP模块
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-06-30 09:55
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/nodejs%E5%85%A8%E8%A7%A3">Nodejs全解</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/nodejs">nodejs</a>
                                &nbsp;
                            
                                <a href="/tags/http">HTTP</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="0-准备工作">0 准备工作</h1>
<h2 id="1-ts-node-dev">1 ts-node-dev</h2>
<ul>
<li>当文件更新时自动重启node</li>
<li>避免每次改完代码都要重新运行的麻烦</li>
<li>可以用TS开发Node.js程序，且会自动重启</li>
<li>不宜在生产环境使用，但非常适合用来学习</li>
</ul>
<p>安装</p>
<pre><code>npm -g i ts-node-dev
</code></pre><p>要用npm安装 ，用yarn安装的话使用时会报错。。无法识别“ts-node-dev”命令，不知道为什么。</p>
<h2 id="2-vscode配置">2 VSCode配置</h2>
<p>配置自动保存与保存后自动格式化：</p>
<p><code>ctrl shift p</code>打开<code>首选项：打开设置(ui)</code>，<code>AutoSave</code>修改为<code>onFocusChange</code>，搜索format，勾选<code>Format On Save</code>开启保存后自动格式化。</p>
<h2 id="3-curl">3 curl</h2>
<ul>
<li>GET请求：<code>curl -v url</code></li>
<li>POST请求：<code>curl -v -d “name=gsq&quot; url</code></li>
<li>设置请求头：<code>-H 'Content-Type:application/json'</code></li>
<li>设置动词：<code>-X PUT</code></li>
<li>JSON请求：<code>curl -d '{&quot;name&quot;:&quot;bob&quot;}' -H 'Content-Type:application/json' url</code></li>
<li>后面会用到<code>curl</code>来构造请求</li>
</ul>
<h1 id="1-创建项目">1 创建项目</h1>
<ul>
<li>初始化项目：</li>
</ul>
<pre><code>yarn init -y
</code></pre><ul>
<li>安装<code>@types/node</code>声明文件</li>
</ul>
<pre><code>yarn add --dev @types/node
</code></pre><ul>
<li>新建<code>index.ts</code></li>
</ul>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#228b22">// 引入http模块
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> http <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>
<span style="color:#228b22">// 用http创建server
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">const</span> server = http.createServer()
<span style="color:#228b22">// 监听server的request事件
</span><span style="color:#228b22"></span>server.on(<span style="color:#cd5555">&#39;request&#39;</span>, (request, response) =&gt; {
	console.log(<span style="color:#cd5555">&#39;有人请求了&#39;</span>)
	response.end(<span style="color:#cd5555">&#39;hi&#39;</span>)<span style="color:#228b22">// 服务器返回data，并终止服务器
</span><span style="color:#228b22"></span>})
<span style="color:#228b22">// 开始监听8888端口
</span><span style="color:#228b22"></span>server.listen(<span style="color:#b452cd">8888</span>)
</code></pre></div><ul>
<li>控制台<code>ts-node-dev index.ts</code>启动服务器</li>
<li>使用<code>curl -v http://localhost:8888 </code>发送请求</li>
</ul>
<h1 id="2-request对象">2 request对象</h1>
<p>http.createServer()创建的server是http.Server和net.Server类的实例，可以创建后端环境（静态服务器）。</p>
<p>首先控制台打出<code>request.contructor</code>，发现request对象的构造函数是<code>IncomingMessage</code>，因此利用ts语法，在传参中直接定义<code>request:IncomingMessage</code>，告诉TypeScript request不是任意对象，而是IncomingMessage对象。</p>
<p>获取请求信息（请求头、路径、请求消息体等）：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> http <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>
<span style="color:#228b22">// 引入IncomingMessage模块
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">import</span> { IncomingMessage } <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>

<span style="color:#8b008b;font-weight:bold">const</span> server = http.createServer()

server.on(<span style="color:#cd5555">&#39;request&#39;</span>, (request: <span style="color:#00688b;font-weight:bold">IncomingMessage</span>, response) =&gt; {
    console.log(request.httpVersion)<span style="color:#228b22">// 获取http版本号
</span><span style="color:#228b22"></span>    console.log(request.url)<span style="color:#228b22">// 获取请求路径
</span><span style="color:#228b22"></span>    console.log(request.headers)<span style="color:#228b22">// 获取请求头
</span><span style="color:#228b22"></span>	<span style="color:#228b22">// 获取请求消息体
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">const</span> arr = []
    <span style="color:#228b22">// 监听data事件
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// 用户每上传一个字节或一段内容就会触发data事件，由于每次上传报文的大小是固定的，所以在用户上传过程中会不停地触发data事件。
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// 因此需要监听每一次的data事件，把每一次上传的数据放到一个数组中
</span><span style="color:#228b22"></span>    request.on(<span style="color:#cd5555">&#39;data&#39;</span>, (chunk) =&gt; {
        arr.push(chunk)
    })
    <span style="color:#228b22">// 监听上传结束事件，end事件只有在数据被完全消费掉后再触发
</span><span style="color:#228b22"></span>    request.on(<span style="color:#cd5555">&#39;end&#39;</span>, () =&gt; {
        <span style="color:#228b22">// 将数据中的每一段chunk连接起来
</span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">const</span> body = Buffer.concat(arr).toString()
        console.log(body)
        <span style="color:#228b22">// 请求处理完成后响应
</span><span style="color:#228b22"></span>        response.end(<span style="color:#cd5555">&#39;hi&#39;</span>)
    })
})

server.listen(<span style="color:#b452cd">8888</span>)
</code></pre></div><p>开启服务器后，利用<code>curl</code>构造请求：</p>
<pre><code>curl -V -d &quot;name=gsq&quot; http://localhost:8888/api/message
</code></pre><p>控制台将打印如下信息：</p>
<pre><code>1.1
/api/message
{
  host: 'localhost:8888',
  'user-agent': 'curl/7.55.1',
  accept: '*/*',
  'content-length': '8',
  'content-type': 'application/x-www-form-urlencoded'
}
name=gsq
</code></pre><p>总结：</p>
<ul>
<li>拥有headers、method、url等属性</li>
<li>从stream.Readable类继承了data、end、error事件</li>
<li>不能直接拿到请求的消息体：原因与TCP有关</li>
</ul>
<h1 id="3-response对象">3 response对象</h1>
<p>同样的方式发现response对象是ServerResponse的实例对象</p>
<ul>
<li>拥有getHeader、setHeader、end、write等方法，可以控制响应的每一部分</li>
<li>拥有statusCode属性，默认为200，可读可写</li>
<li>继承了Stream，也属于Stream类的实例</li>
</ul>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">response.setHeader(<span style="color:#cd5555">&#39;NAME&#39;</span>, <span style="color:#cd5555">&#39;gsq&#39;</span>)
response.statusCode = <span style="color:#b452cd">404</span>
response.write(<span style="color:#cd5555">&#39;1&#39;</span>)
response.write(<span style="color:#cd5555">&#39;2&#39;</span>)
response.end()
<span style="color:#228b22">// 响应的消息体
</span><span style="color:#228b22"></span>&lt; HTTP/<span style="color:#b452cd">1.1</span> <span style="color:#b452cd">404</span> Not Found
&lt; NAME: <span style="color:#00688b;font-weight:bold">gsq</span>
&lt; <span style="color:#658b00">Date</span>: Wed, <span style="color:#b452cd">30</span> Jun <span style="color:#b452cd">2021</span> 05:<span style="color:#00688b;font-weight:bold">56</span>:<span style="color:#b452cd">08</span> GMT
&lt; Connection: <span style="color:#00688b;font-weight:bold">keep</span>-alive
&lt; Keep-Alive: <span style="color:#00688b;font-weight:bold">timeout</span>=<span style="color:#b452cd">5</span>
&lt; Transfer-Encoding: <span style="color:#00688b;font-weight:bold">chunked</span>
&lt;
<span style="color:#b452cd">12</span>
</code></pre></div><h1 id="4-根据url返回不同的文件">4 根据url返回不同的文件</h1>
<blockquote>
<p>思路：通过request获取到用户请求的url，利用switch进行判断，根据请求不同，应用fs.readFile读取页面数据并返回给请求端。</p>
</blockquote>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> fs <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;fs&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> http <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> p <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;path&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> { IncomingMessage, ServerResponse } <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>

<span style="color:#8b008b;font-weight:bold">const</span> server = http.createServer()
<span style="color:#228b22">// 获取当前目录下的public路径，利用resolve方法进行拼接并解析为绝对路径
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">const</span> publicDir = p.relative(__dirname, <span style="color:#cd5555">&#39;public&#39;</span>)

server.on(<span style="color:#cd5555">&#39;request&#39;</span>, (request: <span style="color:#00688b;font-weight:bold">IncomingMessage</span>, response: <span style="color:#00688b;font-weight:bold">ServerResponse</span>) =&gt; {
    <span style="color:#228b22">// 获取到请求路径
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">const</span> { url } = request
    <span style="color:#228b22">// 判断请求路径
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">switch</span> (url) {
        <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#cd5555">&#39;/index.html&#39;</span>:
            <span style="color:#228b22">// 读取index.html文件
</span><span style="color:#228b22"></span>            fs.readFile(p.resolve(publicDir, <span style="color:#cd5555">&#39;index.html&#39;</span>), (error, data) =&gt; {
                <span style="color:#8b008b;font-weight:bold">if</span> (error) <span style="color:#8b008b;font-weight:bold">throw</span> error
                response.end(data.toString())
            })
            <span style="color:#8b008b;font-weight:bold">break</span>;
        <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#cd5555">&#39;/main.js&#39;</span>:
            <span style="color:#228b22">// 在响应的头部声明文件类型
</span><span style="color:#228b22"></span>            response.setHeader(<span style="color:#cd5555">&#39;Content-Type&#39;</span>,<span style="color:#cd5555">&#39;text/javascript; charset=utf-8&#39;</span>)
            fs.readFile(p.resolve(publicDir, <span style="color:#cd5555">&#39;main.js&#39;</span>), (error, data) =&gt; {
                <span style="color:#8b008b;font-weight:bold">if</span> (error) <span style="color:#8b008b;font-weight:bold">throw</span> error
                response.end(data.toString())
            })
            <span style="color:#8b008b;font-weight:bold">break</span>;
        <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#cd5555">&#39;/index.css&#39;</span>:
            <span style="color:#228b22">// 在响应的头部声明文件类型
</span><span style="color:#228b22"></span>            response.setHeader(<span style="color:#cd5555">&#39;Content-Type&#39;</span>,<span style="color:#cd5555">&#39;text/css; charset=utf-8&#39;</span>)
            fs.readFile(p.resolve(publicDir, <span style="color:#cd5555">&#39;index.css&#39;</span>), (error, data) =&gt; {
                <span style="color:#8b008b;font-weight:bold">if</span> (error) <span style="color:#8b008b;font-weight:bold">throw</span> error
                response.end(data.toString())
            })
            <span style="color:#8b008b;font-weight:bold">break</span>;
    }
})

server.listen(<span style="color:#b452cd">8888</span>)
</code></pre></div><p>在浏览器中访问<code>http://localhost:8888/index.html</code></p>
<h1 id="5-处理查询参数">5 处理查询参数</h1>
<blockquote>
<p>当请求的路径带有参数时（&hellip;/index.html?q=1），会影响到switch对路径的判断，从而找不到对应访问的文件，因此需要<code>url模块</code>来处理查询的参数。</p>
</blockquote>
<p>引入url模块时，模块名与request中取到的url同名，所以需要修改url为path：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">const</span> { url:<span style="color:#00688b;font-weight:bold">path</span> } = request
<span style="color:#228b22">// 在request中取到url字段，重命名为path变量
</span></code></pre></div><p><code>url.parse(path)</code>返回一个<code>URL对象</code>，包含如下字段：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">Url {
  protocol: <span style="color:#00688b;font-weight:bold">null</span>, slashes: <span style="color:#00688b;font-weight:bold">null</span>, auth: <span style="color:#00688b;font-weight:bold">null</span>, host: <span style="color:#00688b;font-weight:bold">null</span>,
  port: <span style="color:#00688b;font-weight:bold">null</span>,  hostname: <span style="color:#00688b;font-weight:bold">null</span>,  hash: <span style="color:#00688b;font-weight:bold">null</span>,  search: <span style="color:#cd5555">&#39;?q=2&#39;</span>,
  query: <span style="color:#cd5555">&#39;q=2&#39;</span>, pathname: <span style="color:#cd5555">&#39;/index.html&#39;</span>, path: <span style="color:#cd5555">&#39;/index.html?q=2&#39;</span>,
  href: <span style="color:#cd5555">&#39;/index.html?q=2&#39;</span>
}
</code></pre></div><p>switch只需读取URL对象中的<code>pathname</code>字段来进行判断即可。</p>
<p>**注：**但是目前node版本中，url.parse已被<code>弃用</code>，所以我们直接实例化一个URL对象。URL对象接受两个参数，分别为<code>请求路径</code>与<code>根路径</code>。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">const</span> url = <span style="color:#8b008b;font-weight:bold">new</span> URL(path, <span style="color:#cd5555">&#39;http://localhost:8888&#39;</span>);
<span style="color:#8b008b;font-weight:bold">const</span> { pathname } = <span style="color:#8b008b;font-weight:bold">new</span> URL(path, <span style="color:#cd5555">&#39;http://localhost:8888&#39;</span>) 
</code></pre></div><p>新的URL对象包含如下字段：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">URL {
  href: <span style="color:#cd5555">&#39;http://localhost:8888/index.html?q=1&#39;</span>,
  origin: <span style="color:#cd5555">&#39;http://localhost:8888&#39;</span>,
  protocol: <span style="color:#cd5555">&#39;http:&#39;</span>,
  username: <span style="color:#cd5555">&#39;&#39;</span>,
  password: <span style="color:#cd5555">&#39;&#39;</span>,
  host: <span style="color:#cd5555">&#39;localhost:8888&#39;</span>,
  hostname: <span style="color:#cd5555">&#39;localhost&#39;</span>,
  port: <span style="color:#cd5555">&#39;8888&#39;</span>,
  pathname: <span style="color:#cd5555">&#39;/index.html&#39;</span>,
  search: <span style="color:#cd5555">&#39;?q=1&#39;</span>,
  searchParams: <span style="color:#00688b;font-weight:bold">URLSearchParams</span> { <span style="color:#cd5555">&#39;q&#39;</span> =&gt; <span style="color:#cd5555">&#39;1&#39;</span> },
  hash: <span style="color:#cd5555">&#39;&#39;</span>
}
</code></pre></div><p>同样拥有<code>pathname</code>字段，之后的switch判断与之前保持一致即可。</p>
<h1 id="6-匹配任意文件">6 匹配任意文件</h1>
<p>目前为止我们只能访问三个路径，其他路径均视为404，如果每多一个页面就多写一个case来判断并响应的话，工作量非常大且代码冗余，重复代码很多，因此需要抽取出关键代码，使其能够自动匹配任意访问的文件。</p>
<blockquote>
<p>思路：还是从路径入手，URL对象中的pathname字段的字符串，经过一些字符处理，便可以作为fs读取文件的路径名。例如访问路径为<code>/aa/index.html</code>，则读取路径中需要的字段是<code>aa/index.html</code>，只需将前面的<code>'/'</code>去掉即可。</p>
</blockquote>
<p>修改后代码如下：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> fs <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;fs&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> http <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> * <span style="color:#8b008b;font-weight:bold">as</span> p <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;path&#39;</span>
<span style="color:#8b008b;font-weight:bold">import</span> { IncomingMessage, ServerResponse } <span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#cd5555">&#39;http&#39;</span>

<span style="color:#8b008b;font-weight:bold">const</span> server = http.createServer()
<span style="color:#8b008b;font-weight:bold">const</span> publicDir = p.relative(__dirname, <span style="color:#cd5555">&#39;public&#39;</span>)

server.on(<span style="color:#cd5555">&#39;request&#39;</span>, (request: <span style="color:#00688b;font-weight:bold">IncomingMessage</span>, response: <span style="color:#00688b;font-weight:bold">ServerResponse</span>) =&gt; {
    <span style="color:#8b008b;font-weight:bold">const</span> { url: <span style="color:#00688b;font-weight:bold">path</span> } = request
    <span style="color:#228b22">// 在URL对象中获取pathname字段
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">const</span> { pathname } = <span style="color:#8b008b;font-weight:bold">new</span> URL(path, <span style="color:#cd5555">&#39;http://localhost:8888&#39;</span>)
    <span style="color:#228b22">// 基于访问路径处理文件名
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">const</span> fileName = pathname.substring(<span style="color:#b452cd">1</span>)
    fs.readFile(p.resolve(publicDir, fileName), (error, data) =&gt; {
        <span style="color:#228b22">// 如果读不到文件，则返回404
</span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (error) {
            response.statusCode = <span style="color:#b452cd">404</span>
            response.end()
        }
        <span style="color:#228b22">// 如果成功读取到文件，则返回读取到的数据
</span><span style="color:#228b22"></span>        response.end(data.toString())
    })
})

server.listen(<span style="color:#b452cd">8888</span>)
</code></pre></div><h1 id="7-处理不存在的文件">7 处理不存在的文件</h1>
<blockquote>
<p>对访问文件时出现的错误类型进行判断</p>
</blockquote>
<h2 id="1-文件不存在的情况">1 文件不存在的情况</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">if</span> (error.errno === -<span style="color:#b452cd">4058</span>) {
	response.statusCode = <span style="color:#b452cd">404</span> <span style="color:#228b22">//找不到文件
</span><span style="color:#228b22"></span>    fs.readFile(p.resolve(publicDir, <span style="color:#cd5555">&#39;404.html&#39;</span>), (error, data) =&gt; {
        response.end(data)
        <span style="color:#228b22">// data无需toString()，浏览器自动解析data
</span><span style="color:#228b22"></span>	})
} 
</code></pre></div><h2 id="2-当访问路径为根路径httplocalhost8888时默认访问indexhtml">2 当访问路径为根路径<code>http://localhost:8888</code>时，默认访问index.html</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">let</span> fileName = pathname.substring(<span style="color:#b452cd">1</span>)
<span style="color:#8b008b;font-weight:bold">if</span> (fileName === <span style="color:#cd5555">&#39;&#39;</span>) {
    fileName = <span style="color:#cd5555">&#39;index.html&#39;</span>
}
</code></pre></div><h2 id="3当访问路径不是文件而是目录时">3.当访问路径不是文件而是目录时</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (error.errno === -<span style="color:#b452cd">4068</span>) {
	response.statusCode = <span style="color:#b452cd">403</span> <span style="color:#228b22">//没有权限访问
</span><span style="color:#228b22"></span>	response.end(<span style="color:#cd5555">&#39;无权查看目录内容&#39;</span>)
} 
</code></pre></div><h2 id="4其他错误一律归为服务器内部错误">4.其他错误一律归为服务器内部错误</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#8b008b;font-weight:bold">else</span> {
	response.statusCode = <span style="color:#b452cd">500</span> <span style="color:#228b22">//服务器内部错误
</span><span style="color:#228b22"></span>	response.end(<span style="color:#cd5555">&#39;服务器繁忙，请稍后再试&#39;</span>)
}
</code></pre></div><h1 id="8-处理非get请求">8 处理非GET请求</h1>
<p>静态服务器不会接受非get请求，对Method进行过滤：</p>
<pre><code>const { method } = request
if (method !== 'GET') {
	response.statusCode = 405// Method Not Allowed
	response.end();
	return;
}
</code></pre><h1 id="9-添加缓存选项">9 添加缓存选项</h1>
<p>再次刷新页面时，css、js和图片等静态数据会缓存至内存中，提升网页访问性能。</p>
<p>成功返回数据前，在响应头添加缓存字段：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">response.setHeader(<span style="color:#cd5555">&#39;Cache-Control&#39;</span>,<span style="color:#cd5555">&#39;public max-age=3600&#39;</span>)
</code></pre></div><h1 id="10-发布未完成">10 发布(未完成)</h1>
<p>将ts变成js，需全局安装TypeScript，使用<code>tsc</code>命令进行转换：</p>
<pre><code>tsc index.ts
</code></pre><p>把js作为package.json中的<code>main</code>字段</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#cd5555">&#34;main&#34;</span><span style="color:#a61717;background-color:#e3d2d2">:</span> <span style="color:#cd5555">&#34;index.js&#34;</span>
</code></pre></div><p>发布</p>
<pre><code>yarn login/npm adduser
yarn publish/npm publish
</code></pre>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2021-06-30</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://gsemir0418.github.io/posts/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/">
			下回<br>杂七杂八
                </a>
                
                
                
                <a class="older-posts" href="https://gsemir0418.github.io/posts/%E8%B0%83%E8%AF%95nodejs/">
			上回<br>调试Nodejs
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>






            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2021 GSemir Blog
	
</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://gsemir0418.github.io//js/journal.js"></script>
    </body>
</html>
